<!-- FILE: taxonomy-product_category-juice-concentrates.html LOADED (V3 - Explosion & Colors) -->
<!-- wp:group {"align":"full","style":{"spacing":{"padding":{"right":"0","left":"0"},"margin":{"top":"0"}}},"layout":{"type":"default"}} -->
<div class="wp-block-group alignfull" style="margin-top:0;padding-right:0;padding-left:0"><!-- wp:columns {"align":"full","style":{"spacing":{"padding":{"top":"0","bottom":"0","left":"0","right":"0"},"blockGap":"0"}}} -->
<div class="wp-block-columns alignfull" style="padding-top:0;padding-right:0;padding-bottom:0;padding-left:0;height:100vh;overflow:hidden;gap:0;flex-wrap:nowrap"><!-- wp:column {"width":"20%","className":"product-colour","style":{"spacing":{"padding":{"top":"var:preset|spacing|50","bottom":"var:preset|spacing|50","left":"var:preset|spacing|50","right":"var:preset|spacing|50"},"blockGap":"0"}},"gradient":"fruit-burst"} -->
<div class="wp-block-column product-colour has-fruit-burst-gradient-background has-background" style="padding-top:var(--wp--preset--spacing--50);padding-right:var(--wp--preset--spacing--50);padding-bottom:var(--wp--preset--spacing--50);padding-left:var(--wp--preset--spacing--50);flex:0 0 20%;position:sticky;top:0;height:100vh;overflow-y:auto;z-index:1001"><!-- wp:group {"style":{"spacing":{"margin":{"top":"0","bottom":"0"}}},"layout":{"type":"flex","flexWrap":"nowrap"}} -->
<div class="wp-block-group" style="margin-top:0;margin-bottom:0"></div>
<!-- /wp:group -->

<!-- wp:group {"style":{"dimensions":{"minHeight":"100%"}},"layout":{"type":"flex","orientation":"vertical","verticalAlignment":"bottom","justifyContent":"right"}} -->
<div class="wp-block-group" style="min-height:100%;display:flex;flex-direction:column;justify-content:flex-end;align-items:flex-end">
<!-- wp:shortcode -->
[lemon_current_category_count]
<!-- /wp:shortcode --><!-- wp:query-title {"type":"archive","showPrefix":false,"className":"lemon-rotated-title"} /--></div>
<!-- /wp:group --></div>
<!-- /wp:column -->

<!-- wp:column {"width":null} -->
<div class="wp-block-column" style="flex:1;min-width:0;height:100vh;position:relative;overflow:hidden">
<!-- wp:group {"style":{"dimensions":{"minHeight":"100%"}},"layout":{"type":"default"}} -->
<div class="wp-block-group" style="min-height:100%;height:100%;overflow-y:auto">

<div id="lemon-products-ajax-container" style="height: 100%;">
<!-- wp:query {"queryId":1,"query":{"perPage":30,"pages":0,"offset":0,"postType":"lemon_product","order":"desc","orderBy":"date","author":"","search":"","exclude":[],"sticky":"","inherit":true,"parents":[],"format":[]},"layout":{"type":"default"},"anchor":"lemon-products-query","className":"lemon-products-query-container"} -->
<div id="lemon-products-query" class="wp-block-query lemon-products-query-container" style="height:100%;padding-bottom:0"><!-- wp:post-template {"className":"lemon-product-grid","layout":{"type":"grid","columnCount":5},"style":{"spacing":{"blockGap":"0px"}}} -->
<!-- wp:group {"className":"lemon-product-card","style":{"spacing":{"margin":{"top":"0","bottom":"0"}},"dimensions":{"minHeight":"0px"}},"backgroundColor":"transparent","layout":{"type":"default"}} -->
<div class="wp-block-group lemon-product-card has-transparent-background-color has-background" style="min-height:0px;margin-top:0;margin-bottom:0"><!-- wp:post-featured-image {"isLink":true,"aspectRatio":"1/1","sizeSlug":"full"} /-->

<!-- wp:group {"className":"lemon-product-overlay dynamic-category-bg","style":{"spacing":{"padding":{"right":"var:preset|spacing|50","left":"var:preset|spacing|50"}}},"layout":{"type":"flex","orientation":"vertical","justifyContent":"center"}} -->
<div class="wp-block-group lemon-product-overlay dynamic-category-bg" style="padding-right:var(--wp--preset--spacing--50);padding-left:var(--wp--preset--spacing--50)"><!-- wp:post-title {"textAlign":"center","isLink":true,"style":{"typography":{"fontStyle":"normal","fontWeight":"600","lineHeight":"1.1","fontSize":"clamp(1.25rem, 2vw, 2rem)"}}} /-->

<!-- wp:read-more {"content":">","className":"lemon-view-product-btn","style":{"typography":{"textDecoration":"none"},"elements":{"link":{"color":{"text":"var:preset|color|white"}}}},"textColor":"white","fontSize":"medium"} /--></div>
<!-- /wp:group --></div>
<!-- /wp:group -->
<!-- /wp:post-template -->

<!-- wp:html -->
<style>
:root :where(.is-layout-flow) > * { margin-block-start: 0 !important; }
:where(.wp-site-blocks) > * { margin-block-start: 0 !important; }
.lemon-product-grid { margin: 0 !important; padding: 0 !important; height: 100%; grid-template-rows: repeat(5, 1fr) !important; }
.lemon-product-grid > li { height: auto !important; margin: 0 !important; padding: 0 !important; box-sizing: border-box !important; }
.wp-block-query { margin: 0 !important; height: 100%; }
.lemon-product-card { position: relative; width: 100%; height: 100%; border: 0 solid rgba(0,0,0,0.1); border-right-width: 1px; border-bottom-width: 1px; display: flex; justify-content: center; align-items: center; overflow: hidden; }

@media (min-width: 1601px) {
    .lemon-product-grid > li:nth-child(-n+5) .lemon-product-card { border-top-width: 1px; }
    .lemon-product-grid > li:nth-child(5n+1) .lemon-product-card { border-left-width: 1px; }
}

@media (max-width: 1600px) and (min-width: 1281px) {
    .lemon-product-grid { grid-template-columns: repeat(4, 1fr) !important; }
    .lemon-product-grid > li:nth-child(-n+4) .lemon-product-card { border-top-width: 1px; }
    .lemon-product-grid > li:nth-child(4n+1) .lemon-product-card { border-left-width: 1px; }
}

@media (max-width: 2560px) {
    .lemon-product-overlay .wp-block-post-title { font-size: clamp(0.8rem, 1.2vw, 1.4rem) !important; }
    .lemon-product-overlay { padding: 0.5rem !important; }
    .lemon-view-product-btn { width: 40px !important; height: 40px !important; font-size: 1.5rem !important; }
}

.lemon-product-card .wp-block-post-featured-image { width: auto; height: 60%; aspect-ratio: 1/1; border-radius: 50%; overflow: hidden; margin: 0; }
.lemon-product-card .wp-block-post-featured-image img { width: 100%; height: 100%; object-fit: cover; }
.lemon-product-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--category-color, rgba(255,255,255,0.85)); padding: 1rem; transform: translateY(100%); transition: transform 0.3s ease; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; box-sizing: border-box; color: #ffffff; margin: 0 !important; }
.lemon-product-overlay a { color: #ffffff !important; }
.lemon-product-card:hover .lemon-product-overlay { transform: translateY(0); }
.lemon-product-overlay a.lemon-view-product-btn, .lemon-product-overlay a.lemon-view-product-btn:hover, .lemon-product-overlay a.lemon-view-product-btn:focus { position: absolute !important; bottom: 0; right: 0; width: 60px; height: 60px; background: transparent !important; background-color: transparent !important; color: #fff !important; display: flex !important; align-items: center; justify-content: center; padding: 0 !important; border: none !important; border-top: 1px solid #fff !important; border-left: 1px solid #fff !important; border-radius: 0 !important; font-size: 2rem !important; line-height: 1 !important; text-decoration: none !important; box-shadow: none !important; outline: none !important; }
.lemon-product-card:hover { border-color: var(--category-color, #F6B501); }
.lemon-filter-modal {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    display: block !important;
    position: fixed !important;
    top: 0 !important;
    right: auto !important;
    left: 0 !important;
    width: 20vw !important;
    max-width: calc(100vw - 60px) !important;
    height: 100vh !important;
    background-color: #000000 !important;
    color: #ffffff;
    z-index: 2000 !important;
    box-shadow: none;
    overflow-y: auto;
    padding: 40px !important;
    box-sizing: border-box !important;
}
.lemon-filter-modal.is-open { transform: translateX(0); }
.lemon-filter-modal label, .lemon-filter-modal .widget-title, .lemon-filter-modal a, .lemon-filter-modal span, .lemon-filter-modal h2, .lemon-filter-modal h3, .lemon-filter-modal h4 { color: #ffffff !important; }
.lemon-rotated-title { writing-mode: vertical-lr !important; transform: rotate(180deg) !important; font-size: clamp(2rem, 10vh, 10rem) !important; line-height: 0.8 !important; max-height: 100vh; width: 100%; text-align: left; margin-right: 1.5rem !important; margin-bottom: 3rem !important; }
.lemon-category-count {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    margin-top: 0;
    margin-right: 6rem;
    font-size: 2rem;
    font-weight: 600;
    line-height: 1;
    background-color: #ffffff;
    color: #000000;
    opacity: 0;
    transform: scale(0.5);
    transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    z-index: 10;
}
.lemon-category-count.is-visible { opacity: 1; transform: scale(1); }
.lemon-category-info {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    display: block !important;
    position: fixed !important;
    top: 0 !important;
    right: auto !important;
    left: 0 !important;
    width: 20vw !important;
    max-width: calc(100vw - 60px) !important;
    height: 100vh !important;
    background-color: #000000 !important;
    color: #ffffff !important;
    z-index: 2000 !important;
    padding: 4rem !important;
    box-sizing: border-box !important;
}
.lemon-category-info.is-visible { transform: translateX(0); }
.lemon-mobile-menu-drawer {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    display: block !important;
    position: fixed !important;
    top: 0 !important;
    right: auto !important;
    left: 0 !important;
    width: 20vw !important;
    max-width: calc(100vw - 60px) !important;
    height: 100vh !important;
    background-color: #000000 !important;
    color: #ffffff !important;
    z-index: 2000 !important;
    padding: 60px !important;
    box-sizing: border-box !important;
}
.lemon-mobile-menu-drawer.is-open { transform: translateX(0); }
.lemon-mobile-menu-overlay { display: none !important; }
.lemon-info-toggle-btn, .lemon-filter-toggle-custom, .lemon-mobile-menu-toggle, .lemon-theme-toggle-btn, .lemon-back-toggle-btn { background: transparent !important; border: none; cursor: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 2L10 22L22 10L2 2Z' stroke='black' stroke-width='2'/%3E%3C/svg%3E") 2 2, pointer; padding: 10px; display: flex; align-items: center; justify-content: center; color: inherit; width: 100%; }
.lemon-mobile-menu-close, .lemon-filter-close-btn, .lemon-info-close-btn { background: transparent !important; border: none !important; cursor: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 2L10 22L22 10L2 2Z' stroke='black' stroke-width='2'/%3E%3C/svg%3E") 2 2, pointer; color: inherit; padding: 0; }
.lemon-info-toggle-btn.is-active, .lemon-filter-toggle-custom.is-active, .lemon-mobile-menu-toggle.is-active { position: relative; color: #F6B501; }
.lemon-info-toggle-btn.is-active::after, .lemon-filter-toggle-custom.is-active::after, .lemon-mobile-menu-toggle.is-active::after {
    content: ''; position: absolute; top: 6px; right: 6px; width: 8px; height: 8px;
    background-color: #F6B501; border-radius: 50%;
    box-shadow: 0 0 0 0 rgba(246, 181, 1, 1);
    animation: pulse-orange 2s infinite;
}
@keyframes pulse-orange {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(246, 181, 1, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(246, 181, 1, 0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(246, 181, 1, 0); }
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.lemon-particle { position: absolute; border-radius: 50%; pointer-events: none; z-index: 1; }
body.lemon-dark-mode { background-color: #000000 !important; color: #ffffff !important; }
body.lemon-dark-mode .wp-block-group, body.lemon-dark-mode .wp-block-column, body.lemon-dark-mode main { background-color: #000000 !important; color: #ffffff !important; }
body.lemon-dark-mode .lemon-product-card { border-color: rgba(255,255,255,0.3); }
body.lemon-dark-mode .lemon-info-toggle-btn, body.lemon-dark-mode .lemon-filter-toggle-custom, body.lemon-dark-mode .lemon-mobile-menu-toggle, body.lemon-dark-mode .lemon-theme-toggle-btn, body.lemon-dark-mode .lemon-back-toggle-btn, body.lemon-dark-mode .lemon-mobile-menu-close, body.lemon-dark-mode .lemon-filter-close-btn, body.lemon-dark-mode .lemon-info-close-btn {
    cursor: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 2L10 22L22 10L2 2Z' stroke='white' stroke-width='2'/%3E%3C/svg%3E") 2 2, pointer;
}
body.lemon-dark-mode h1, body.lemon-dark-mode h2, body.lemon-dark-mode h3, body.lemon-dark-mode h4, body.lemon-dark-mode h5, body.lemon-dark-mode h6, body.lemon-dark-mode p, body.lemon-dark-mode span, body.lemon-dark-mode a, body.lemon-dark-mode li { color: #ffffff !important; }
body.lemon-dark-mode .product-colour { background: #000000 !important; }
body.lemon-dark-mode .lemon-product-overlay { background-color: rgba(0,0,0,0.9); border: none !important; }
body.lemon-dark-mode .lemon-product-card:hover { border-color: rgba(255,255,255,0.3) !important; }
body.lemon-dark-mode .lemon-filter-modal { border-right: 1px solid #ffffff !important; }
body.lemon-dark-mode .lemon-category-count { background-color: #000000; color: #ffffff; }
.lemon-category-info .lemon-concentrate-breadcrumbs {
    display: none !important;
    align-items: center;
    gap: 8px;
    background: none !important;
    border-radius: 100px;
    width: fit-content;
    max-width: 100%;
    padding: 10px 20px;
    border: 1px solid #ffffff;
    box-sizing: border-box;
    color: white;
}

.lemon-category-info a:where(:not(.wp-element-button)) {
    color: #ffffff;
    text-decoration: underline;
}

@media (max-width: 1280px) {
    .product-colour { 
        display: block !important; 
        width: 100% !important; 
        height: auto !important; 
        flex: 0 0 auto !important; 
        padding: 20px !important; 
        overflow: visible !important;
        position: relative !important;
        z-index: 1 !important;
        order: -2 !important;
    }
    .product-colour > .wp-block-group:last-child { flex-direction: row-reverse !important; align-items: center !important; justify-content: space-between !important; min-height: 0 !important; }
    .lemon-rotated-title { writing-mode: horizontal-tb !important; transform: none !important; width: auto !important; max-height: none !important; margin: 0 !important; text-align: left !important; font-size: 2.5rem !important; }
    .lemon-category-count { margin: 0 !important; }

    .wp-block-columns.alignfull { flex-direction: column !important; height: auto !important; overflow: visible !important; }
    
    /* Content Column */
    .wp-block-column:nth-child(2) { flex: 1 1 auto !important; height: auto !important; overflow: visible !important; }
    
    /* Toolbar Column */
    .wp-block-column:last-child { 
        order: -1 !important; 
        width: 100% !important; 
        flex: 0 0 auto !important; 
        height: auto !important; 
        min-height: 60px !important; 
        flex-direction: row !important; 
        padding: 10px 20px !important; 
        position: sticky !important; 
        top: 0 !important; 
        z-index: 3000 !important;
        border-bottom: 1px solid #333;
    }
    
    /* Toolbar Inner Group */
    .wp-block-column:last-child > .wp-block-group { 
        flex-direction: row !important; 
        width: 100%; 
        justify-content: space-between; 
        align-items: center; 
    }
    
    /* Toolbar Elements */
    .lemon-info-toggle-btn, .lemon-filter-toggle-custom, .lemon-mobile-menu-toggle, .lemon-theme-toggle-btn { 
        width: auto !important; 
        margin: 0 !important; 
    }
    .wp-block-column:last-child .wp-block-spacer { display: none !important; }
    
    /* Modals */
    .lemon-filter-modal, .lemon-category-info, .lemon-mobile-menu-drawer { 
        width: 100% !important; 
        max-width: 100% !important; 
        top: calc(var(--lemon-toolbar-bottom, 60px) - 1px) !important; 
        height: calc(100vh - var(--lemon-toolbar-bottom, 60px) + 1px) !important; 
        right: 0 !important; 
        left: 0 !important; 
        margin: 0 !important;
        transform: translateY(-100%) !important;
        opacity: 0 !important;
        visibility: hidden !important;
        transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease !important;
    }
    .lemon-filter-modal.is-open, .lemon-category-info.is-visible, .lemon-mobile-menu-drawer.is-open {
        transform: translateY(0) !important;
        opacity: 1 !important;
        visibility: visible !important;
    }

    .lemon-product-grid { grid-template-columns: repeat(3, 1fr) !important; grid-template-rows: auto !important; }
    .lemon-product-grid > li { height: auto !important; aspect-ratio: 1/1; }
    .lemon-filter-modal, .lemon-category-info, .lemon-mobile-menu-drawer { width: calc(100vw - 60px) !important; max-width: 100% !important; }
}
@media (max-width: 1280px) and (min-width: 769px) {
    .lemon-product-grid > li:nth-child(-n+3) .lemon-product-card { border-top-width: 1px; }
    .lemon-product-grid > li:nth-child(3n+1) .lemon-product-card { border-left-width: 1px; }
}
@media (max-width: 768px) {
    .lemon-product-grid { grid-template-columns: repeat(2, 1fr) !important; }
    .lemon-product-grid > li:nth-child(-n+2) .lemon-product-card { border-top-width: 1px; }
    .lemon-product-grid > li:nth-child(2n+1) .lemon-product-card { border-left-width: 1px; }
}
.lemon-primary-menu-wrapper ul { list-style: none; padding: 0; margin: 0; }
.lemon-primary-menu-wrapper ul li { margin-bottom: 1rem; }
.lemon-primary-menu-wrapper ul li a { color: #ffffff; text-decoration: none; font-size: 1.5rem; font-weight: 500; display: block; }
.lemon-primary-menu-wrapper ul ul { padding-left: 2rem; margin-top: 0.5rem; }
.lemon-primary-menu-wrapper ul ul li a { font-size: 1.2rem; opacity: 0.8; }
.lemon-category-count.pop { animation: lemonPop 2.5s ease-in-out; } @keyframes lemonPop { 0% { transform: scale(1); } 10% { transform: scale(1.25); } 20% { transform: scale(0.95); } 30% { transform: scale(1.1); } 40% { transform: scale(1); } 100% { transform: scale(1); } }
.wpc-filters-main-wrap .wpc-filters-labels li.wpc-term-item label span.wpc-filter-label-wrapper {
    padding: 4px 7px !important;
    font-size: 1.125rem !important;
}
.wpc-filters-main-wrap .wpc-filters-labels li.wpc-term-item {
    margin-bottom: 0.5rem !important;
}
</style>
<!-- /wp:html -->

<!-- /wp:query --></div>
</div>
<!-- /wp:group --></div></div>
<!-- /wp:column -->

<!-- wp:column {"width":"60px","style":{"spacing":{"padding":{"top":"var:preset|spacing|50"}}},"backgroundColor":"primary","textColor":"base"} -->
<div class="wp-block-column has-base-color has-text-color has-primary-background-color has-background" style="padding-top:var(--wp--preset--spacing--50);flex:0 0 60px;position:sticky;top:0;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;padding-bottom:2rem;z-index:3000"><!-- wp:group {"layout":{"type":"flex","orientation":"vertical"}} -->
<div class="wp-block-group">

<!-- wp:spacer {"height":"20px"} -->
<div style="height:20px" aria-hidden="true" class="wp-block-spacer"></div>
<!-- /wp:spacer -->

<!-- wp:html -->
<button onclick="history.back()" class="lemon-back-toggle-btn" aria-label="Back" style="margin-bottom: 20px;"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg></button>
<button class="lemon-mobile-menu-toggle" aria-label="Menu"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
<button class="lemon-info-toggle-btn" aria-label="Info" style="margin-bottom: 20px;"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></button>
<button class="lemon-filter-toggle-custom" aria-label="Filters"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg></button>
<button class="lemon-theme-toggle-btn" aria-label="Toggle Theme" style="margin-top: 20px;"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Lemon Template Loaded: Juice Concentrates - V3');

    // Dark Mode Persistence
    function applyDarkMode(isDark) {
        const productCol = document.querySelector('.product-colour');
        if (isDark) {
            document.body.classList.add('lemon-dark-mode');
            if(productCol) {
                if (!productCol.dataset.originalBg) productCol.dataset.originalBg = productCol.style.backgroundColor;
                productCol.style.setProperty('background-color', '#000000', 'important');
                productCol.style.setProperty('background-image', 'none', 'important');
            }
        } else {
            document.body.classList.remove('lemon-dark-mode');
            if(productCol) {
                if (productCol.dataset.originalBg) productCol.style.setProperty('background-color', productCol.dataset.originalBg, 'important');
                else productCol.style.removeProperty('background-color');
                productCol.style.removeProperty('background-image');
            }
        }
    }
    if (localStorage.getItem('lemonDarkMode') === 'true') applyDarkMode(true);

    const infoBtn = document.querySelector('.lemon-info-toggle-btn');
    const infoCloseBtn = document.querySelector('.lemon-info-close-btn');
    const infoPanel = document.querySelector('.lemon-category-info');
    
    const menuBtn = document.querySelector('.lemon-mobile-menu-toggle');
    const menuDrawer = document.querySelector('.lemon-mobile-menu-drawer');
    const menuCloseBtn = document.querySelector('.lemon-mobile-menu-close');

    const filterBtn = document.querySelector('.lemon-filter-toggle-custom');
    const filterModal = document.querySelector('.lemon-filter-modal');
    const filterCloseBtn = document.querySelector('.lemon-filter-close-btn');
    const themeBtn = document.querySelector('.lemon-theme-toggle-btn');

    function createExplosion(element) {
        const parent = element.parentElement;
        if (window.getComputedStyle(parent).position === 'static') {
            parent.style.position = 'relative';
        }

        const colors = ['#FFF700', '#FF9900', '#D32F2F', '#FF6F61', '#C6FF00', '#FF6D00', '#FF1744', '#880E4F', '#ffffff'];
        const rect = element.getBoundingClientRect();
        const parentRect = parent.getBoundingClientRect();
        
        const centerX = (rect.left - parentRect.left) + rect.width / 2;
        const centerY = (rect.top - parentRect.top) + rect.height / 2;

        for (let i = 0; i < 50; i++) {
            const particle = document.createElement('div');
            particle.classList.add('lemon-particle');
            parent.appendChild(particle);

            const color = colors[Math.floor(Math.random() * colors.length)];
            particle.style.backgroundColor = color;
            
            const size = Math.random() * 10 + 5;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            
            particle.style.left = `${centerX}px`;
            particle.style.top = `${centerY}px`;

            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 150 + 50;
            
            const tx = Math.cos(angle) * velocity;
            const ty = Math.sin(angle) * velocity;

            const animation = particle.animate([
                { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
                { transform: `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(0)`, opacity: 0 }
            ], {
                duration: 1000 + Math.random() * 500,
                easing: 'cubic-bezier(0, .9, .57, 1)',
            });

            animation.onfinish = () => particle.remove();
        }
    }

    function updateLayout() {
        const toolbarBtn = document.querySelector('.lemon-mobile-menu-toggle');
        if (toolbarBtn) {
            const toolbar = toolbarBtn.closest('.wp-block-column');
            if (toolbar) {
                const rect = toolbar.getBoundingClientRect();
                document.documentElement.style.setProperty('--lemon-toolbar-bottom', rect.bottom + 'px');
            }
        }
    }

    function closeAllPanels() {
        if(infoPanel) infoPanel.classList.remove('is-visible');
        if(infoBtn) infoBtn.classList.remove('is-active');
        
        if(menuDrawer) menuDrawer.classList.remove('is-open');
        if(menuBtn) menuBtn.classList.remove('is-active');
        
        if(filterModal) filterModal.classList.remove('is-open');
        if(filterBtn) filterBtn.classList.remove('is-active');
        document.body.style.overflow = '';
    }

    if(infoBtn && infoPanel) {
        infoBtn.addEventListener('click', function() {
            const isOpen = infoPanel.classList.contains('is-visible');
            closeAllPanels();
            if (!isOpen) {
                updateLayout();
                infoPanel.classList.add('is-visible');
                infoBtn.classList.add('is-active');
                document.body.style.overflow = 'hidden';
            }
        });
    }
    if(infoCloseBtn && infoPanel) {
        infoCloseBtn.addEventListener('click', function() {
            infoPanel.classList.remove('is-visible');
            if(infoBtn) infoBtn.classList.remove('is-active');
        });
    }

    if(themeBtn) {
        themeBtn.addEventListener('click', function() {
            closeAllPanels();
            const isDark = !document.body.classList.contains('lemon-dark-mode');
            applyDarkMode(isDark);
            localStorage.setItem('lemonDarkMode', isDark);
        });
    }

    if(menuBtn && menuDrawer) {
        menuBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const isOpen = menuDrawer.classList.contains('is-open');
            closeAllPanels();
            if (!isOpen) {
                updateLayout();
                menuDrawer.classList.add('is-open');
                menuBtn.classList.add('is-active');
                document.body.style.overflow = 'hidden';
            }
        });
    }
    if(menuCloseBtn && menuDrawer) {
        menuCloseBtn.addEventListener('click', function() {
            menuDrawer.classList.remove('is-open');
            if(menuBtn) menuBtn.classList.remove('is-active');
        });
    }

    if(filterBtn && filterModal) {
        filterBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const isOpen = filterModal.classList.contains('is-open');
            closeAllPanels();
            if (!isOpen) {
                updateLayout();
                filterModal.classList.add('is-open');
                filterBtn.classList.add('is-active');
                document.body.style.overflow = 'hidden';
            }
        });
    }
    if(filterCloseBtn && filterModal) {
        filterCloseBtn.addEventListener('click', function() {
            filterModal.classList.remove('is-open');
            if(filterBtn) filterBtn.classList.remove('is-active');
        });
    }

    // Category Count Animation
    const countEl = document.querySelector('.lemon-category-count');
    if (countEl) {
        const finalValue = parseInt(countEl.innerText, 10) || 0;
        countEl.innerText = '0';
        
        const isDarkMode = document.body.classList.contains('lemon-dark-mode');

        const colors = [
            { bg: 'var(--wp--preset--color--lemon-yellow)', text: '#000000' },
            { bg: 'var(--wp--preset--color--orange)', text: '#000000' },
            { bg: 'var(--wp--preset--color--blood-orange)', text: '#ffffff' },
            { bg: 'var(--wp--preset--color--grapefruit)', text: '#000000' },
            { bg: 'var(--wp--preset--color--pomegranate)', text: '#ffffff' },
            { bg: 'var(--wp--preset--color--strawberry-red)', text: '#ffffff' },
            { bg: 'var(--wp--preset--color--mandarin)', text: '#000000' },
            { bg: 'var(--wp--preset--color--lime-green)', text: '#000000' },
            { bg: isDarkMode ? '#000000' : '#ffffff', text: isDarkMode ? '#ffffff' : '#000000' }
        ];

        setTimeout(() => {
            countEl.classList.add('is-visible');
            let startTimestamp = null;
            const duration = 1500;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                countEl.innerText = Math.floor(progress * finalValue);
                
                if (progress < 1) {
                    // Cycle colors based on progress
                    const colorIndex = Math.floor(progress * (colors.length - 1));
                    if (colors[colorIndex]) {
                        countEl.style.backgroundColor = colors[colorIndex].bg;
                        countEl.style.color = colors[colorIndex].text;
                    }
                    window.requestAnimationFrame(step);
                } else {
                    countEl.style.backgroundColor = '';
                    countEl.style.color = '';
                    setTimeout(() => {
                        countEl.classList.add('pop');
                        createExplosion(countEl);
                    }, 100);
                }
            };
            window.requestAnimationFrame(step);
        }, 500);
    }
});
</script>
<!-- /wp:html --></div>
<!-- /wp:group --></div>
<!-- /wp:column --></div>
<!-- /wp:columns --></div>

<!-- wp:group {"className":"lemon-category-info","style":{"spacing":{"padding":{"top":"var:preset|spacing|60","bottom":"var:preset|spacing|60","left":"var:preset|spacing|60","right":"var:preset|spacing|60"}}},"layout":{"type":"constrained"}} -->
<div class="wp-block-group lemon-category-info" style="padding-top:var(--wp--preset--spacing--60);padding-right:var(--wp--preset--spacing--60);padding-bottom:var(--wp--preset--spacing--60);padding-left:var(--wp--preset--spacing--60)"><!-- wp:group {"style":{"spacing":{"margin":{"bottom":"var:preset|spacing|50"}}},"layout":{"type":"flex","justifyContent":"space-between"}} -->
<div class="wp-block-group" style="margin-bottom:var(--wp--preset--spacing--50)"><!-- wp:heading -->
<h2 class="wp-block-heading">Information</h2>
<!-- /wp:heading -->

<!-- wp:html -->
<button class="lemon-info-close-btn" aria-label="Close Info"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
<!-- /wp:html --></div>
<!-- /wp:group -->

<!-- wp:lemon-concentrate/breadcrumbs {"name":"lemon-concentrate/breadcrumbs","mode":"preview"} /-->

<!-- wp:term-description /-->
</div>
<!-- /wp:group -->

<!-- wp:group {"className":"lemon-mobile-menu-drawer","style":{"spacing":{"padding":{"top":"var:preset|spacing|60","bottom":"var:preset|spacing|60","left":"var:preset|spacing|60","right":"var:preset|spacing|60"}}},"layout":{"type":"constrained"}} -->
<div class="wp-block-group lemon-mobile-menu-drawer" style="padding-top:var(--wp--preset--spacing--60);padding-right:var(--wp--preset--spacing--60);padding-bottom:var(--wp--preset--spacing--60);padding-left:var(--wp--preset--spacing--60)"><!-- wp:group {"style":{"spacing":{"margin":{"bottom":"var:preset|spacing|50"}}},"layout":{"type":"flex","justifyContent":"space-between"}} -->
<div class="wp-block-group" style="margin-bottom:var(--wp--preset--spacing--50)"><!-- wp:heading -->
<h2 class="wp-block-heading">Menu</h2>
<!-- /wp:heading -->

<!-- wp:html -->
<button class="lemon-mobile-menu-close" aria-label="Close Menu"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
<!-- /wp:html --></div>
<!-- /wp:group -->

<!-- wp:shortcode -->
[lemon_primary_menu]
<!-- /wp:shortcode --></div>
<!-- /wp:group -->

<!-- wp:group {"className":"lemon-filter-modal","style":{"spacing":{"padding":{"top":"var:preset|spacing|60","bottom":"var:preset|spacing|60","left":"var:preset|spacing|60","right":"var:preset|spacing|60"}}},"layout":{"type":"constrained"}} -->
<div class="wp-block-group lemon-filter-modal" style="padding-top:var(--wp--preset--spacing--60);padding-right:var(--wp--preset--spacing--60);padding-bottom:var(--wp--preset--spacing--60);padding-left:var(--wp--preset--spacing--60)"><!-- wp:group {"style":{"spacing":{"margin":{"top":"var:preset|spacing|50","bottom":"var:preset|spacing|50"}}},"layout":{"type":"flex","justifyContent":"space-between"}} -->
<div class="wp-block-group" style="margin-top:var(--wp--preset--spacing--50);margin-bottom:var(--wp--preset--spacing--50)"><!-- wp:heading -->
<h2 class="wp-block-heading">Filters</h2>
<!-- /wp:heading -->

<!-- wp:html -->
<button class="lemon-filter-close-btn" aria-label="Close Filters"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
<!-- /wp:html --></div>
<!-- /wp:group -->

<!-- wp:shortcode -->
[fe_widget]
<!-- /wp:shortcode --></div>
<!-- /wp:group -->